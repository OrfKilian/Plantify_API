{% extends 'base.html' %}

{% block title %}{{ trivial }} ({{ botanisch }}){% endblock %}
{% block page_title %}{{ trivial }} ({{ botanisch }}){% endblock %}

{% block content %}
<div class="dashboard">
    <div class="card full-width-card" id="extra-facts">
        <h3>Allgemeine Pflegehinweise</h3>
        <textarea id="pflege-textarea"
                  placeholder="Hinweise hier eingeben..."
                  class="pflege-edit"
                  rows="4"
                  style="min-height: 40px; resize: none;"></textarea>
    </div>

    <div class="card">
        <h3>Datenwerte</h3>
        <canvas id="chart-data"></canvas>
    </div>
    <div class="card" id="facts-box">
        <h3>Pflanzen Fakten</h3>
        <textarea id="facts-textarea" class="pflege-edit" rows="3" placeholder="Fakten hier eingeben...">{{ plant.facts }}</textarea>
        <div style="margin-top:10px;">
            <label for="room-select">Zimmer:</label>
            <select id="room-select" class="pflege-edit" style="height:auto;">
                {% for room in rooms %}
                <option value="{{ room.name }}" {% if room.name == plant.room %}selected{% endif %}>{{ room.name }}</option>
                {% endfor %}
            </select>
        </div>
        <button id="save-facts-btn" class="pflege-edit" style="margin-top:10px;">Speichern</button>
    </div>
</div>

<!-- Add Chart.js library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Add our plant.js file -->
<script src="{{ url_for('static', filename='plant.js') }}"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const textarea = document.getElementById('pflege-textarea');
  if (textarea) {
    textarea.addEventListener('input', function () {
      this.style.height = 'auto';
      this.style.height = Math.max(this.scrollHeight, 40) + 'px';
    });
    textarea.dispatchEvent(new Event('input'));
  }

  const saveBtn = document.getElementById('save-facts-btn');
  if (saveBtn) {
    saveBtn.addEventListener('click', async function () {
      const facts = document.getElementById('facts-textarea').value;
      const room = document.getElementById('room-select').value;
      await fetch('/api/plants/{{ plant.id }}', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({facts: facts, room: room})
      });
      alert('Gespeichert');
    });
  }
});
</script>
{% endblock %}
